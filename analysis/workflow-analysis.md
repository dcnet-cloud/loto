# PhÃ¢n TÃ­ch Workflow Tá»•ng Thá»ƒ - á»¨ng Dá»¥ng Gá»i LÃ´ TÃ´

---

## 1. WORKFLOW Tá»”NG QUAN

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APP INITIALIZATION                        â”‚
â”‚                                                              â”‚
â”‚  DOMContentLoaded                                            â”‚
â”‚  â”œâ”€ UI.init()              â†’ Cache 50+ DOM elements          â”‚
â”‚  â”œâ”€ UI.renderNumberBoard() â†’ Táº¡o 90 Ã´ sá»‘ trÃªn grid          â”‚
â”‚  â”œâ”€ SpeechEngine.init()    â†’ Khá»Ÿi táº¡o Audio + load phrases   â”‚
â”‚  â”œâ”€ CallPhraseManager.init() â†’ Load custom phrases tá»« LS     â”‚
â”‚  â”œâ”€ GameHistoryManager.init() â†’ Load history tá»« LS           â”‚
â”‚  â”œâ”€ GameHistoryManager.startNewGame() â†’ Báº¯t Ä‘áº§u tracking     â”‚
â”‚  â”œâ”€ new LotoCaller()       â†’ Shuffle 90 sá»‘, set callbacks    â”‚
â”‚  â”œâ”€ App.bindEvents()       â†’ Bindtáº¥t cáº£ event listeners      â”‚
â”‚  â”œâ”€ App.initFullscreen()                                     â”‚
â”‚  â”œâ”€ App.initShare()                                          â”‚
â”‚  â”œâ”€ App.initTheme()        â†’ Load theme tá»« LS                â”‚
â”‚  â”œâ”€ App.initFontSize()     â†’ Load font size tá»« LS            â”‚
â”‚  â”œâ”€ App.initQR()                                             â”‚
â”‚  â”œâ”€ UI.updateStats(0, 90)                                    â”‚
â”‚  â””â”€ PWAInstall.init()      â†’ Láº¯ng nghe install prompt        â”‚
â”‚                                                              â”‚
â”‚  Service Worker Registration (parallel)                      â”‚
â”‚  â””â”€ navigator.serviceWorker.register('/sw.js')               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. CORE GAME FLOW

### 2.1 Gá»i Sá»‘ (Manual Call)

```
User Action: Click "Gá»i Sá»‘" HOáº¶C nháº¥n Space
         â”‚
         â–¼
â”Œâ”€â”€â”€ DEBOUNCE CHECK â”€â”€â”€â”
â”‚ now - lastCallTime    â”‚
â”‚ < 500ms? â†’ SKIP       â”‚
â”‚ isProcessing? â†’ SKIP  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ Pass
           â–¼
â”Œâ”€â”€â”€ CALL NUMBER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  1. LotoCaller.callNumber()                           â”‚
â”‚     â”œâ”€ randomIndex = SecureRandom.getInt(remaining)   â”‚
â”‚     â”œâ”€ number = numbers.splice(randomIndex, 1)[0]     â”‚
â”‚     â”œâ”€ calledNumbers.push(number)                     â”‚
â”‚     â””â”€ trigger onNumberCalled(number)                 â”‚
â”‚                                                       â”‚
â”‚  2. App.handleNumberCalled(number)                    â”‚
â”‚     â”œâ”€ isProcessing = true (LOCK)                     â”‚
â”‚     â”œâ”€ GameHistoryManager.recordNumber(number)        â”‚
â”‚     â”‚                                                 â”‚
â”‚     â”œâ”€ GET PHRASE:                                    â”‚
â”‚     â”‚  funnyEnabled?                                  â”‚
â”‚     â”‚  â”œâ”€ YES â†’ CallPhraseManager.getRandomPhrase(n)  â”‚
â”‚     â”‚  â”‚       (70% custom / 30% default)             â”‚
â”‚     â”‚  â””â”€ NO â†’ "Sá»‘ {number}"                          â”‚
â”‚     â”‚                                                 â”‚
â”‚     â”œâ”€ SUSPENSE PHASE (t=0):                          â”‚
â”‚     â”‚  â”œâ”€ UI.updateDisplaySuspense("?", cÃ¢u rao)      â”‚
â”‚     â”‚  â””â”€ SpeechEngine.speakNumber(number, funnyCall) â”‚
â”‚     â”‚     â”œâ”€ TTS: Ä‘á»c cÃ¢u rao (speed 0.85x)          â”‚
â”‚     â”‚     â”œâ”€ Pause 800ms (hoáº·c 3500ms náº¿u cÃ¢u há»i)  â”‚
â”‚     â”‚     â””â”€ TTS: Ä‘á»c "Sá»‘ {number}" (speed 1x)       â”‚
â”‚     â”‚                                                 â”‚
â”‚     â”œâ”€ REVEAL PHASE (t=3000ms):                       â”‚
â”‚     â”‚  â”œâ”€ UI.revealNumber(number)                     â”‚
â”‚     â”‚  â”‚  â”œâ”€ Display: "?" â†’ number (animation pulse)  â”‚
â”‚     â”‚  â”‚  â””â”€ Board: cell.classList.add('called',      â”‚
â”‚     â”‚  â”‚            'just-called') â†’ remove after 600msâ”‚
â”‚     â”‚  â”œâ”€ UI.updateHistory(last 5 numbers)            â”‚
â”‚     â”‚  â”œâ”€ UI.updateStats(called, remaining)           â”‚
â”‚     â”‚  â”‚                                              â”‚
â”‚     â”‚  â”œâ”€ LUCKY CHECK:                                â”‚
â”‚     â”‚  â”‚  number âˆˆ [7,8,9,39,68,77,79,88]?            â”‚
â”‚     â”‚  â”‚  â””â”€ YES â†’ cell.add('lucky-hit')              â”‚
â”‚     â”‚  â”‚         â†’ ConfettiEffect.burst(x, y, 15)    â”‚
â”‚     â”‚  â”‚         â†’ remove 'lucky-hit' after 600ms    â”‚
â”‚     â”‚  â”‚                                              â”‚
â”‚     â”‚  â””â”€ isProcessing = false (UNLOCK)               â”‚
â”‚     â”‚                                                 â”‚
â”‚     â””â”€ AUDIO CALLBACK:                                â”‚
â”‚        SpeechEngine.onAudioFinished                   â”‚
â”‚        â””â”€ game.audioFinished()                        â”‚
â”‚           â””â”€ (chá»‰ relevant cho auto mode)             â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Auto Mode Flow

```
User: Click "Tá»± Äá»™ng" HOáº¶C nháº¥n A
         â”‚
         â–¼
â”Œâ”€â”€â”€ TOGGLE AUTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  isAutoMode?                                          â”‚
â”‚  â”œâ”€ YES â†’ STOP AUTO                                  â”‚
â”‚  â”‚  â”œâ”€ game.stopAuto()                               â”‚
â”‚  â”‚  â”‚  â”œâ”€ isAutoMode = false                         â”‚
â”‚  â”‚  â”‚  â””â”€ clearTimeout(autoTimeout)                  â”‚
â”‚  â”‚  â””â”€ UI.setAutoMode(false) â†’ icon: â–¶ "Tá»± Äá»™ng"    â”‚
â”‚  â”‚                                                   â”‚
â”‚  â””â”€ NO â†’ START AUTO                                  â”‚
â”‚     â”œâ”€ speed = speedSlider.value * 1000              â”‚
â”‚     â”‚  (clamped to [3000, 10000] ms)                 â”‚
â”‚     â”œâ”€ game.startAuto(speed)                         â”‚
â”‚     â”‚  â”œâ”€ isAutoMode = true                          â”‚
â”‚     â”‚  â””â”€ callNumber() â†’ gá»i sá»‘ Ä‘áº§u tiÃªn ngay        â”‚
â”‚     â””â”€ UI.setAutoMode(true) â†’ icon: â¸ "Dá»«ng"        â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€ AUTO LOOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  callNumber()                                         â”‚
â”‚       â”‚                                               â”‚
â”‚       â–¼                                               â”‚
â”‚  handleNumberCalled(num)                              â”‚
â”‚       â”‚                                               â”‚
â”‚       â–¼                                               â”‚
â”‚  speakNumber() â”€â”€â”€â”€â”€â”€â–º Audio playing...               â”‚
â”‚                              â”‚                        â”‚
â”‚                              â–¼                        â”‚
â”‚                     onAudioFinished()                  â”‚
â”‚                              â”‚                        â”‚
â”‚                              â–¼                        â”‚
â”‚                     game.audioFinished()               â”‚
â”‚                              â”‚                        â”‚
â”‚                     isAutoMode?                        â”‚
â”‚                     â”œâ”€ NO â†’ STOP                      â”‚
â”‚                     â””â”€ YES                            â”‚
â”‚                        â”‚                              â”‚
â”‚                        â–¼                              â”‚
â”‚                     numbers.length > 0?               â”‚
â”‚                     â”œâ”€ NO â†’ stopAuto() + onGameOver() â”‚
â”‚                     â””â”€ YES                            â”‚
â”‚                        â”‚                              â”‚
â”‚                        â–¼                              â”‚
â”‚                     waitTime = max(500,               â”‚
â”‚                       autoSpeed - 3000)               â”‚
â”‚                        â”‚                              â”‚
â”‚                        â–¼                              â”‚
â”‚                     setTimeout(callNumber, waitTime)  â”‚
â”‚                        â”‚                              â”‚
â”‚                        â””â”€â”€â”€â”€ LOOP â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3 Game Over Flow

```
numbers.length === 0
         â”‚
         â–¼
â”Œâ”€â”€â”€ GAME OVER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  1. UI.setGameOver()                                  â”‚
â”‚     â”œâ”€ currentNumber.textContent = "XONG"             â”‚
â”‚     â”œâ”€ funnyCall.textContent = "ChÃºc má»«ng!..."       â”‚
â”‚     â”œâ”€ callBtn.disabled = true                        â”‚
â”‚     â””â”€ body.classList.add('game-over')               â”‚
â”‚                                                       â”‚
â”‚  2. GameHistoryManager.endGame(true)                  â”‚
â”‚     â”œâ”€ currentGame.endTime = now                      â”‚
â”‚     â”œâ”€ currentGame.isComplete = true                  â”‚
â”‚     â”œâ”€ history.unshift(currentGame)                   â”‚
â”‚     â”œâ”€ Trim to MAX_GAMES (20)                         â”‚
â”‚     â””â”€ Save to localStorage                          â”‚
â”‚                                                       â”‚
â”‚  3. ConfettiEffect.create(80)                         â”‚
â”‚     â””â”€ 80 confetti particles rÆ¡i tá»« trÃªn              â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. RESET GAME FLOW

```
User: Click "ChÆ¡i Láº¡i" HOáº¶C nháº¥n R
         â”‚
         â–¼
â”Œâ”€â”€â”€ CONFIRM DIALOG â”€â”€â”€â”
â”‚  "Báº¡n cÃ³ cháº¯c cháº¯n   â”‚
â”‚   muá»‘n chÆ¡i láº¡i?"    â”‚
â”‚                       â”‚
â”‚  [CÃ³]        [KhÃ´ng]  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚          â”‚
    â–¼          â–¼
  RESET      CANCEL
    â”‚        (close modal)
    â–¼
â”Œâ”€â”€â”€ RESET SEQUENCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  1. SpeechEngine.stop()                               â”‚
â”‚     â””â”€ Dá»«ng audio Ä‘ang phÃ¡t                           â”‚
â”‚                                                       â”‚
â”‚  2. GameHistoryManager.endGame(false)                  â”‚
â”‚     â””â”€ LÆ°u game hiá»‡n táº¡i (isComplete: false)          â”‚
â”‚                                                       â”‚
â”‚  3. game.reset()                                      â”‚
â”‚     â”œâ”€ stopAuto() â†’ clear timeout                     â”‚
â”‚     â””â”€ init() â†’ shuffle máº£ng [1..90] má»›i              â”‚
â”‚                                                       â”‚
â”‚  4. UI.resetUI()                                      â”‚
â”‚     â”œâ”€ currentNumber = "--"                           â”‚
â”‚     â”œâ”€ funnyCall = "Báº¥m 'Gá»i Sá»‘' Ä‘á»ƒ báº¯t Ä‘áº§u!"       â”‚
â”‚     â”œâ”€ callBtn.disabled = false                       â”‚
â”‚     â”œâ”€ history = empty                                â”‚
â”‚     â”œâ”€ Remove 'game-over' from body                   â”‚
â”‚     â”œâ”€ Remove 'called' from all cells                 â”‚
â”‚     â”œâ”€ updateStats(0, 90)                             â”‚
â”‚     â””â”€ setAutoMode(false)                             â”‚
â”‚                                                       â”‚
â”‚  5. UI.hideConfirmModal()                             â”‚
â”‚                                                       â”‚
â”‚  6. GameHistoryManager.startNewGame()                  â”‚
â”‚     â””â”€ Táº¡o game object má»›i vá»›i startTime              â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. TICKET CHECKING FLOW

```
User: Click "Kiá»ƒm Tra VÃ©"
         â”‚
         â–¼
â”Œâ”€â”€â”€ OPEN MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Nháº­p 5 sá»‘ trÃªn má»™t hÃ ng vÃ©:                â”‚      â”‚
â”‚  â”‚ [__] [__] [__] [__] [__]                    â”‚      â”‚
â”‚  â”‚                                              â”‚      â”‚
â”‚  â”‚ [Kiá»ƒm Tra VÃ©]              [XÃ³a Háº¿t]       â”‚      â”‚
â”‚  â”‚                                              â”‚      â”‚
â”‚  â”‚ â”Œâ”€ Káº¾T QUáº¢ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚      â”‚
â”‚  â”‚ â”‚ ÄÃ£ trÃºng: 3  â”‚  CÃ²n thiáº¿u: 2           â”‚ â”‚      â”‚
â”‚  â”‚ â”‚ [23] [45] [67]â”‚  [12] [89]              â”‚ â”‚      â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Click "Kiá»ƒm Tra VÃ©" (submit):
         â”‚
         â–¼
â”Œâ”€â”€â”€ VALIDATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  For each input box:                                  â”‚
â”‚  â”œâ”€ Parse integer                                     â”‚
â”‚  â”œâ”€ Valid: 1 â‰¤ num â‰¤ 90 â†’ add to ticketNumbers       â”‚
â”‚  â”œâ”€ Invalid: add class 'invalid' (red border + shake) â”‚
â”‚  â””â”€ Empty: skip                                       â”‚
â”‚                                                       â”‚
â”‚  ticketNumbers.length === 0?                          â”‚
â”‚  â””â”€ YES â†’ alert("Vui lÃ²ng nháº­p Ã­t nháº¥t 1 sá»‘")       â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€ COMPARE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  calledOnTicket = ticket âˆ© calledNumbers              â”‚
â”‚  missingOnTicket = ticket - calledNumbers             â”‚
â”‚                                                       â”‚
â”‚  Display Results:                                     â”‚
â”‚  â”œâ”€ ÄÃ£ trÃºng: count + green number tags              â”‚
â”‚  â”œâ”€ CÃ²n thiáº¿u: count + red number tags               â”‚
â”‚  â”‚                                                    â”‚
â”‚  â””â”€ ALL MATCHED? (missing === 0 && ticket.length > 0) â”‚
â”‚     â””â”€ YES â†’ "ğŸ‰ KINH! TrÃºng háº¿t!"                   â”‚
â”‚            â†’ ConfettiEffect.create(100)               â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. TTS (TEXT-TO-SPEECH) FLOW

```
speakNumber(number, funnyCall)
         â”‚
         â–¼
â”Œâ”€â”€â”€ TTS PIPELINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  SpeechEngine.enabled?                                â”‚
â”‚  â”œâ”€ NO â†’ setTimeout(onAudioFinished, 100) â†’ RETURN   â”‚
â”‚  â””â”€ YES                                              â”‚
â”‚     â”‚                                                 â”‚
â”‚     â”œâ”€ isPlaying? â†’ RETURN (prevent overlap)          â”‚
â”‚     â”‚                                                 â”‚
â”‚     â”œâ”€ isPlaying = true                               â”‚
â”‚     â”œâ”€ stopCurrentAudio() (cleanup previous)          â”‚
â”‚     â”‚                                                 â”‚
â”‚     â”œâ”€ funnyCall EXISTS?                              â”‚
â”‚     â”‚  â”‚                                              â”‚
â”‚     â”‚  â”œâ”€ YES:                                        â”‚
â”‚     â”‚  â”‚  â”œâ”€ playTTSAudio(funnyCall, 0.85x)          â”‚
â”‚     â”‚  â”‚  â”‚       â”‚                                   â”‚
â”‚     â”‚  â”‚  â”‚       â–¼                                   â”‚
â”‚     â”‚  â”‚  â”‚  â”Œâ”€ NETLIFY FUNCTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚ GET /.netlify/functions/tts      â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚   ?num=1                         â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚   &text={encodedText}            â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚   &speed={speed}                 â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚                                  â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚ Response: audio blob             â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚ â†’ createObjectURL()              â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚ â†’ new Audio(url)                 â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚ â†’ audio.play()                   â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚ â†’ wait onended/onerror           â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚ â†’ revokeObjectURL() cleanup      â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚                                  â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â”‚ Timeout: 10 giÃ¢y (force stop)    â”‚     â”‚
â”‚     â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚     â”‚  â”‚  â”‚                                           â”‚
â”‚     â”‚  â”‚  â”œâ”€ Success?                                 â”‚
â”‚     â”‚  â”‚  â”‚  â”œâ”€ YES â†’ pause (800ms or 3500ms)         â”‚
â”‚     â”‚  â”‚  â”‚  â”‚      â†’ playTTSAudio("Sá»‘ {n}", 1x)     â”‚
â”‚     â”‚  â”‚  â”‚  â””â”€ NO â†’ playTTSAudio("{call}, sá»‘ {n}")   â”‚
â”‚     â”‚  â”‚  â”‚         (fallback: Ä‘á»c gá»™p 1 láº§n)         â”‚
â”‚     â”‚  â”‚                                              â”‚
â”‚     â”‚  â””â”€ NO:                                         â”‚
â”‚     â”‚     â””â”€ playTTSAudio("Sá»‘ {number}", 1x)          â”‚
â”‚     â”‚                                                 â”‚
â”‚     â”œâ”€ isPlaying = false                              â”‚
â”‚     â””â”€ onAudioFinished() â†’ trigger auto next call     â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. PHRASE MANAGEMENT FLOW

```
User: Click "Quáº£n LÃ½ CÃ¢u Rao"
         â”‚
         â–¼
â”Œâ”€â”€â”€ PHRASE MANAGER MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Chá»n sá»‘: [â–¼ 1-90 dropdown]                   â”‚    â”‚
â”‚  â”‚                                               â”‚    â”‚
â”‚  â”‚ CÃ¢u rao cho sá»‘ 7:                             â”‚    â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚
â”‚  â”‚ â”‚ â— "Báº£y ngÃ y trong tuáº§n" [DEFAULT] [ğŸ—‘]  â”‚ â”‚    â”‚
â”‚  â”‚ â”‚ â— "Lucky number seven" [CUSTOM] [âœ][ğŸ—‘] â”‚ â”‚    â”‚
â”‚  â”‚ â”‚ â— "Báº£y viÃªn ngá»c rá»“ng" [CUSTOM] [âœ][ğŸ—‘]â”‚ â”‚    â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚
â”‚  â”‚                                               â”‚    â”‚
â”‚  â”‚ [________________________] [ThÃªm]             â”‚    â”‚
â”‚  â”‚                                               â”‚    â”‚
â”‚  â”‚ [Reset vá» máº·c Ä‘á»‹nh]                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Phrase Selection Logic khi gá»i sá»‘:
         â”‚
         â–¼
â”Œâ”€â”€â”€ getRandomPhrase(num) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  1. Láº¥y default phrases (tá»« SpeechEngine.callsCache) â”‚
â”‚     - Lá»c bá» phrases bá»‹ hidden                       â”‚
â”‚                                                       â”‚
â”‚  2. Láº¥y custom phrases (tá»« localStorage)              â”‚
â”‚                                                       â”‚
â”‚  3. CÃ³ cáº£ custom VÃ€ default?                          â”‚
â”‚     â”œâ”€ YES â†’ Random(100):                             â”‚
â”‚     â”‚  â”œâ”€ < 70 â†’ chá»n tá»« pool CUSTOM                 â”‚
â”‚     â”‚  â””â”€ â‰¥ 70 â†’ chá»n tá»« pool DEFAULT                â”‚
â”‚     â”‚                                                 â”‚
â”‚     â””â”€ NO â†’ chá»n tá»« pool cÃ³ sáºµn                       â”‚
â”‚        â””â”€ KhÃ´ng cÃ³ gÃ¬? â†’ return "Sá»‘ {num}"            â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. THEME & SETTINGS FLOW

```
â”Œâ”€â”€â”€ THEME TOGGLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  Click theme button                                   â”‚
â”‚  â”‚                                                    â”‚
â”‚  â”œâ”€ Read: document.documentElement[data-theme]        â”‚
â”‚  â”œâ”€ Toggle: dark â†” light                             â”‚
â”‚  â”œâ”€ Apply: setAttribute('data-theme', newTheme)       â”‚
â”‚  â”œâ”€ Save: localStorage.setItem('loto-theme', theme)   â”‚
â”‚  â””â”€ Update icon: moon â†” sun                          â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€ FONT SIZE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  Click A+ or A-                                       â”‚
â”‚  â”‚                                                    â”‚
â”‚  â”œâ”€ currentIndex += direction (-1 or +1)              â”‚
â”‚  â”œâ”€ Clamp: [0, 2] (small, medium, large)             â”‚
â”‚  â”œâ”€ Remove all font classes from <html>               â”‚
â”‚  â”œâ”€ Add new font class to <html>                      â”‚
â”‚  â””â”€ Save: localStorage.setItem('loto-font-size')     â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. GAME HISTORY FLOW

```
â”Œâ”€â”€â”€ DURING GAME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  startNewGame() â†’ { id, startTime, calledNumbers: [] }â”‚
â”‚       â”‚                                               â”‚
â”‚       â–¼                                               â”‚
â”‚  recordNumber(num) â†’ push { number, timestamp }       â”‚
â”‚       â”‚ (gá»i má»—i khi callNumber)                      â”‚
â”‚       â–¼                                               â”‚
â”‚  endGame(isComplete)                                   â”‚
â”‚  â”œâ”€ Set endTime                                       â”‚
â”‚  â”œâ”€ Set isComplete (true=háº¿t 90 sá»‘, false=reset sá»›m) â”‚
â”‚  â”œâ”€ Chá»‰ lÆ°u náº¿u calledNumbers.length > 0             â”‚
â”‚  â”œâ”€ Unshift vÃ o history array (má»›i nháº¥t Ä‘áº§u tiÃªn)    â”‚
â”‚  â”œâ”€ Trim to 20 games max                              â”‚
â”‚  â””â”€ Save to localStorage                             â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€ VIEW HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  History List:                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ #1  06/02/2026 14:30  â”‚ 45/90 sá»‘ â”‚ 12:34  â”‚ â–º   â”‚
â”‚  â”‚ #2  06/02/2026 10:15  â”‚ 90/90 sá»‘ â”‚ 25:10  â”‚ â–º   â”‚
â”‚  â”‚ ...                                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                       â”‚
â”‚  Click â–º â†’ Game Detail Modal:                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ NgÃ y: 06/02/2026 14:30                      â”‚     â”‚
â”‚  â”‚ Thá»i lÆ°á»£ng: 12:34                           â”‚     â”‚
â”‚  â”‚ ÄÃ£ gá»i: 45/90                               â”‚     â”‚
â”‚  â”‚                                              â”‚     â”‚
â”‚  â”‚ Báº£ng sá»‘ (mini grid 10 cá»™t):                 â”‚     â”‚
â”‚  â”‚ [01] [02] 03 [04] 05 06 [07] 08 09 [10]    â”‚     â”‚
â”‚  â”‚ (sá»‘ Ä‘Ã£ gá»i Ä‘Æ°á»£c highlight)                  â”‚     â”‚
â”‚  â”‚                                              â”‚     â”‚
â”‚  â”‚ Thá»© tá»± gá»i:                                 â”‚     â”‚
â”‚  â”‚ 45 â†’ 23 â†’ 67 â†’ 12 â†’ 89 â†’ ...               â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 9. DATA FLOW DIAGRAM

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â”‚  User Input  â”‚â”€â”€â”€â”€â–ºâ”‚  App (Main)  â”‚â”€â”€â”€â”€â–ºâ”‚  UI Module   â”‚
â”‚  (Click/Key) â”‚     â”‚  Controller  â”‚     â”‚  (Render)    â”‚
â”‚              â”‚     â”‚              â”‚     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚             â”‚             â”‚
              â–¼             â–¼             â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ LotoCaller â”‚ â”‚  Speech    â”‚ â”‚  History   â”‚
     â”‚ (Game      â”‚ â”‚  Engine    â”‚ â”‚  Manager   â”‚
     â”‚  Engine)   â”‚ â”‚  (TTS)     â”‚ â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚              â”‚              â”‚
           â–¼              â–¼              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Secure    â”‚ â”‚  Netlify   â”‚ â”‚ localStorageâ”‚
     â”‚  Random    â”‚ â”‚  Function  â”‚ â”‚            â”‚
     â”‚ (Crypto)   â”‚ â”‚  (TTS API) â”‚ â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  Google    â”‚
                   â”‚  TTS API   â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 CALL PHRASE MANAGER                    â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚  Default     â”‚    â”‚  Custom     â”‚                  â”‚
â”‚  â”‚  Phrases     â”‚    â”‚  Phrases    â”‚                  â”‚
â”‚  â”‚  (hardcoded) â”‚    â”‚  (localStorage)â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚         â”‚                   â”‚                         â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                   â”‚                                   â”‚
â”‚                   â–¼                                   â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚         â”‚  getRandomPhrase â”‚                          â”‚
â”‚         â”‚  70% custom      â”‚                          â”‚
â”‚         â”‚  30% default     â”‚                          â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. STATE MACHINE DIAGRAM

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  IDLE   â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”‚ (Ready) â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜        â”‚
          â”‚             â”‚             â”‚
     [Tá»± Äá»™ng]    [Gá»i Sá»‘]     [ChÆ¡i Láº¡i]
          â”‚        /Space             â”‚
          â”‚             â”‚             â–¼
          â”‚             â–¼        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ CONFIRM â”‚
          â”‚       â”‚ CALLING  â”‚   â”‚ RESET   â”‚
          â”‚       â”‚(Processing)â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
          â”‚       â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   [CÃ³] â”‚ [KhÃ´ng]
          â”‚            â”‚          â”‚    â”‚
          â”‚            â”‚          â”‚    â””â”€â”€â–º IDLE
          â”‚     (3s reveal)       â”‚
          â”‚            â”‚          â–¼
          â”‚            â–¼     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ RESET   â”‚
          â”‚       â”‚ CALLED â”‚ â”‚         â”‚â”€â”€â–º IDLE
          â”‚       â”‚(Ready  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚       â”‚ next)  â”‚
          â”‚       â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
          â”‚           â”‚
          â”‚      remaining > 0?
          â”‚      â”œâ”€ YES â†’ IDLE
          â”‚      â””â”€ NO â†’ GAME OVER
          â”‚
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  AUTO    â”‚
    â”‚  MODE    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
         â”‚                       â”‚
    callNumber()                 â”‚
         â”‚                       â”‚
         â–¼                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
    â”‚ CALLING  â”‚                 â”‚
    â”‚ (Auto)   â”‚                 â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                 â”‚
         â”‚                       â”‚
    audioFinished()              â”‚
         â”‚                       â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                  â”‚
    â”‚ WAITING â”‚                  â”‚
    â”‚ (pause) â”‚                  â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                  â”‚
         â”‚                       â”‚
    setTimeout(waitTime)â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    remaining === 0?
    â””â”€ YES â†’ GAME OVER

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ GAME     â”‚
    â”‚ OVER     â”‚
    â”‚          â”‚â”€â”€[ChÆ¡i Láº¡i]â”€â”€â–º CONFIRM RESET
    â”‚ "XONG"   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 11. SECURITY & FAIRNESS MODEL

```
â”Œâ”€â”€â”€ RANDOMIZATION PIPELINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                       â”‚
â”‚  Layer 1: INITIALIZATION                              â”‚
â”‚  â”œâ”€ Táº¡o array [1, 2, 3, ..., 90]                     â”‚
â”‚  â””â”€ Fisher-Yates shuffle (Crypto API)                 â”‚
â”‚     â””â”€ Má»—i swap dÃ¹ng SecureRandom.getInt()           â”‚
â”‚                                                       â”‚
â”‚  Layer 2: SELECTION                                   â”‚
â”‚  â”œâ”€ randomIndex = SecureRandom.getInt(remaining)      â”‚
â”‚  â””â”€ splice(randomIndex, 1) â†’ remove from pool         â”‚
â”‚                                                       â”‚
â”‚  SecureRandom.getInt(max):                            â”‚
â”‚  â”œâ”€ crypto.getRandomValues(Uint8Array)                â”‚
â”‚  â”œâ”€ Bit masking: chá»‰ láº¥y Ä‘Ãºng sá»‘ bits cáº§n            â”‚
â”‚  â”œâ”€ Rejection sampling: reject náº¿u result â‰¥ max      â”‚
â”‚  â”‚  (trÃ¡nh modulo bias)                               â”‚
â”‚  â””â”€ Fallback: trung bÃ¬nh 3 Math.random()              â”‚
â”‚                                                       â”‚
â”‚  Result: Uniform distribution, unpredictable          â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 12. Tá»”NG Káº¾T WORKFLOW

### 12.1 Luá»“ng chÃ­nh (Happy Path)

```
1. User má»Ÿ app â†’ Init táº¥t cáº£ modules â†’ Hiá»‡n báº£ng sá»‘ trá»‘ng
2. User báº¥m "Gá»i Sá»‘" â†’ Random sá»‘ â†’ Suspense "?" (3s) â†’ Reveal â†’ Update UI
3. Láº·p láº¡i bÆ°á»›c 2 (manual hoáº·c auto)
4. Kiá»ƒm tra vÃ© báº¥t ká»³ lÃºc nÃ o â†’ So khá»›p â†’ KINH náº¿u trÃºng háº¿t
5. Gá»i háº¿t 90 sá»‘ â†’ Game Over + confetti
6. ChÆ¡i láº¡i â†’ Confirm â†’ Reset â†’ Game má»›i
```

### 12.2 Luá»“ng phá»¥

```
- Toggle dark/light mode â†’ LÆ°u preference
- Thay Ä‘á»•i font size â†’ LÆ°u preference
- Quáº£n lÃ½ cÃ¢u rao â†’ CRUD phrases â†’ LÆ°u localStorage
- Xem lá»‹ch sá»­ â†’ Browse games â†’ Xem chi tiáº¿t
- Share (Facebook/Copy link)
- QR Code Ä‘á»ƒ chia sáº» URL
- PWA Install banner
- Fullscreen mode
```

### 12.3 Error Handling

```
- TTS fail â†’ fallback gá»™p text, hoáº·c skip audio
- Audio timeout â†’ force stop sau 10s
- Invalid ticket input â†’ highlight red + shake
- Empty ticket â†’ alert message
- localStorage fail â†’ silent catch, tiáº¿p tá»¥c cháº¡y
- Service worker fail â†’ graceful degradation
- Crypto API unavailable â†’ fallback better random
```
